<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Direct</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #FF4444;
            margin-bottom: 1rem;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            background: #FF4444;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 0.5rem;
            font-size: 1rem;
        }
        .btn:hover {
            background: #CC0000;
        }
        .btn-secondary {
            background: #2C2C2C;
        }
        pre {
            background: #f0f0f0;
            padding: 1rem;
            border-radius: 5px;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #4CAF50; font-weight: bold; }
        .error { color: #F44336; font-weight: bold; }
        .info { color: #2196F3; font-weight: bold; }
        #console-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1rem;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
        }
        .console-log { color: #4CAF50; }
        .console-error { color: #F44336; }
        .console-warn { color: #FF9800; }
    </style>
</head>
<body>
    <h1>üß™ Test API Direct - Siap Santap</h1>
    
    <div class="test-section">
        <h2>1. Quick Actions</h2>
        <button class="btn" onclick="testProductsAPI()">Test Products API</button>
        <button class="btn" onclick="testSingleProduct()">Test Single Product</button>
        <button class="btn btn-secondary" onclick="clearResults()">Clear Results</button>
        <button class="btn btn-secondary" onclick="openDebugPHP()">Open Debug PHP</button>
    </div>
    
    <div class="test-section">
        <h2>2. Console Output</h2>
        <div id="console-output">Waiting for test...</div>
    </div>
    
    <div class="test-section">
        <h2>3. API Response</h2>
        <div id="api-status"></div>
        <pre id="api-response">No response yet</pre>
    </div>
    
    <div class="test-section">
        <h2>4. Products Display</h2>
        <div id="products-display"></div>
    </div>

    <script src="frontend/js/app.js"></script>
    <script>
        const consoleOutput = document.getElementById('console-output');
        const logs = [];
        
        // Override console methods
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = function(...args) {
            logs.push({ type: 'log', message: args.join(' ') });
            updateConsole();
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            logs.push({ type: 'error', message: args.join(' ') });
            updateConsole();
            originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
            logs.push({ type: 'warn', message: args.join(' ') });
            updateConsole();
            originalWarn.apply(console, args);
        };
        
        function updateConsole() {
            consoleOutput.innerHTML = logs.map(log => 
                `<div class="console-${log.type}">[${log.type.toUpperCase()}] ${escapeHtml(log.message)}</div>`
            ).join('');
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function clearResults() {
            logs.length = 0;
            updateConsole();
            document.getElementById('api-response').textContent = 'Cleared';
            document.getElementById('products-display').innerHTML = '';
            document.getElementById('api-status').innerHTML = '';
        }
        
        function openDebugPHP() {
            window.open('debug-products.php', '_blank');
        }
        
        async function testProductsAPI() {
            console.log('='.repeat(50));
            console.log('üß™ Testing Products API');
            console.log('='.repeat(50));
            
            try {
                const statusDiv = document.getElementById('api-status');
                statusDiv.innerHTML = '<p class="info">‚è≥ Loading...</p>';
                
                const result = await api.get('products.php');
                
                document.getElementById('api-response').textContent = JSON.stringify(result, null, 2);
                
                if (result.success) {
                    statusDiv.innerHTML = `<p class="success">‚úì API Success! Found ${result.data.length} products</p>`;
                    
                    if (result.data.length > 0) {
                        displayProducts(result.data);
                    } else {
                        document.getElementById('products-display').innerHTML = 
                            '<p class="error">‚ö†Ô∏è No products in database. Please add products first.</p>';
                    }
                } else {
                    statusDiv.innerHTML = `<p class="error">‚úó API Failed: ${result.message}</p>`;
                }
                
            } catch (error) {
                console.error('Test failed:', error);
                document.getElementById('api-status').innerHTML = 
                    `<p class="error">‚úó Error: ${error.message}</p>`;
            }
        }
        
        async function testSingleProduct() {
            console.log('='.repeat(50));
            console.log('üß™ Testing Single Product API');
            console.log('='.repeat(50));
            
            try {
                // First get all products
                const allProducts = await api.get('products.php');
                
                if (allProducts.success && allProducts.data.length > 0) {
                    const firstProduct = allProducts.data[0];
                    console.log('Testing with product ID:', firstProduct.product_id);
                    
                    const result = await api.get(`products.php?id=${firstProduct.product_id}`);
                    
                    document.getElementById('api-response').textContent = JSON.stringify(result, null, 2);
                    
                    if (result.success) {
                        document.getElementById('api-status').innerHTML = 
                            `<p class="success">‚úì Single Product API Success!</p>`;
                        displayProducts([result.data]);
                    } else {
                        document.getElementById('api-status').innerHTML = 
                            `<p class="error">‚úó API Failed: ${result.message}</p>`;
                    }
                } else {
                    document.getElementById('api-status').innerHTML = 
                        '<p class="error">‚ö†Ô∏è No products to test with</p>';
                }
                
            } catch (error) {
                console.error('Test failed:', error);
                document.getElementById('api-status').innerHTML = 
                    `<p class="error">‚úó Error: ${error.message}</p>`;
            }
        }
        
        function displayProducts(products) {
            const container = document.getElementById('products-display');
            
            const available = products.filter(p => p.is_available && !p.is_archived);
            const unavailable = products.filter(p => !p.is_available || p.is_archived);
            
            let html = `
                <h3>üìä Summary</h3>
                <p>Total: ${products.length} | Available: ${available.length} | Unavailable: ${unavailable.length}</p>
            `;
            
            if (available.length > 0) {
                html += '<h3 class="success">‚úì Available Products (will show on frontend)</h3>';
                html += '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem;">';
                available.forEach(product => {
                    html += `
                        <div style="border: 2px solid #4CAF50; padding: 1rem; border-radius: 5px;">
                            <h4>${product.product_name}</h4>
                            <p><strong>ID:</strong> ${product.product_id}</p>
                            <p><strong>Price:</strong> ${formatCurrency(product.price)}</p>
                            <p><strong>Stock:</strong> ${product.stock}</p>
                            <p><strong>Category:</strong> ${product.category_name || 'None'}</p>
                            <p style="color: #4CAF50;">‚úì Available</p>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            if (unavailable.length > 0) {
                html += '<h3 class="error" style="margin-top: 2rem;">‚úó Unavailable Products (hidden on frontend)</h3>';
                html += '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem;">';
                unavailable.forEach(product => {
                    const reason = !product.is_available ? 'Not Available' : 'Archived';
                    html += `
                        <div style="border: 2px solid #F44336; padding: 1rem; border-radius: 5px; opacity: 0.7;">
                            <h4>${product.product_name}</h4>
                            <p><strong>ID:</strong> ${product.product_id}</p>
                            <p><strong>Price:</strong> ${formatCurrency(product.price)}</p>
                            <p><strong>Stock:</strong> ${product.stock}</p>
                            <p style="color: #F44336;">‚úó ${reason}</p>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            container.innerHTML = html;
        }
        
        // Auto-run test on load
        window.addEventListener('load', () => {
            console.log('Page loaded, running auto-test in 1 second...');
            setTimeout(() => {
                testProductsAPI();
            }, 1000);
        });
    </script>
</body>
</html>
